---
title: "Visualizing bandit selection"
params:
  path: "derived_data/chtc_0728/"
output:
  html_document:
    df_print: paged
---

```{r}
library(tidyverse)
```


```{r}
result_list <- list()
tar_ball_paths <- list.files(params$path, pattern = "*tar.gz")
i <- 1
for(tar_ball_path in tar_ball_paths) {
  split_name <- tar_ball_path %>% str_remove(".tar.gz") %>% str_split("_") %>% unlist
  path <- str_c(params$path, tar_ball_path)
  untar(path, exdir = params$path)
  
  if (dir.exists(str_c(params$path, "derived_data/"))) {
    result_list[[i]] <- read.csv(str_c(params$path, "derived_data/", list.files(str_c(params$path, "derived_data", ""), pattern = "train_log.csv"))) %>%
    mutate(target_target = split_name[length(split_name) - 2],
           algorithm = split_name[length(split_name) - 1],
           target_size = split_name[length(split_name)] %>% as.numeric())
    result_list[[i]] <- result_list[[i]] %>%
      mutate(epoch = 1:nrow(result_list[[i]]))
  i <- i + 1
  system("rm -r derived_data/chtc_0728/derived_data")
  }
  
}
```


```{r}
bind_rows(result_list) %>%
  ggplot() +
  geom_point(aes(x = epoch, y = val_acc, color = algorithm))
```

